
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Java GraphQL Client - The DGS Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="The DGS Framework" class="md-header-nav__button md-logo" aria-label="The DGS Framework">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            The DGS Framework
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Java GraphQL Client
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The DGS Framework" class="md-nav__button md-logo" aria-label="The DGS Framework">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    The DGS Framework
  </label>
  
    <div class="md-nav__source">
      
<a href="/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../query-execution-testing/" class="md-nav__link">
      Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mutations/" class="md-nav__link">
      Mutations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../generating-code-from-schema/" class="md-nav__link">
      Code Generation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-loaders/" class="md-nav__link">
      Async Data Fetching
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced/error-handling/" class="md-nav__link">
      Error Handling
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    <label class="md-nav__link" for="nav-8">
      Advanced
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Advanced" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Java GraphQL Client
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Java GraphQL Client
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-client-wrapper" class="md-nav__link">
    HTTP client wrapper
  </a>
  
    <nav class="md-nav" aria-label="HTTP client wrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors" class="md-nav__link">
    Errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-safe-query-api" class="md-nav__link">
    Type safe Query API
  </a>
  
    <nav class="md-nav" aria-label="Type safe Query API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interface-projections" class="md-nav__link">
    Interface projections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-federated-queries" class="md-nav__link">
    Building Federated Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/customizing/" class="md-nav__link">
      Custom Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/security/" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/file-uploads/" class="md-nav__link">
      File Uploads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/subscriptions/" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/type-resolvers-for-abstract-types/" class="md-nav__link">
      Type Resolvers for Abstract Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/custom-datafetcher-context/" class="md-nav__link">
      Data Fetching Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/federated-testing/" class="md-nav__link">
      Federated Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/schema-from-code/" class="md-nav__link">
      Generating Schema from Code
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-client-wrapper" class="md-nav__link">
    HTTP client wrapper
  </a>
  
    <nav class="md-nav" aria-label="HTTP client wrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors" class="md-nav__link">
    Errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-safe-query-api" class="md-nav__link">
    Type safe Query API
  </a>
  
    <nav class="md-nav" aria-label="Type safe Query API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interface-projections" class="md-nav__link">
    Interface projections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-federated-queries" class="md-nav__link">
    Building Federated Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="/edit/java-client.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Java GraphQL Client</h1>
                
                <h2 id="usage">Usage</h2>
<p>The DGS framework provides a GraphQL client that can be used to retrieve data from a GraphQL endpoint.
The client has two components, each usable by itself, or in combination together.</p>
<ul>
<li>GraphQLClient - A HTTP client wrapper that provides easy parsing of GraphQL responses</li>
<li>Query API codegen - Generate type-safe Query builders</li>
</ul>
<h2 id="http-client-wrapper">HTTP client wrapper</h2>
<p>The GraphQL client wraps any HTTP client and provides easy parsing of GraphQL responses.
The client can be used against any GraphQL endpoint (it doesn't have to be implemented with the DGS framework),
but provides extra conveniences for parsing Gateway and DGS responses.
This includes support for the <a href="advanced/graphql-error-spec">Errors Spec</a>.</p>
<p>To use the client, create an instance of <code>DefaultGraphQLClient</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">GraphQLClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultGraphQLClient</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</code></pre></div>
<p>The <code>url</code> is the server url of the endpoint you want to call.
This url will be passed down to the callback discussed below.</p>
<p>Using the <code>GraphQLClient</code> a query can be executed.
The <code>executeQuery</code> method has three arguments:</p>
<ol>
<li>The query String</li>
<li>An optional map of query variables</li>
<li>An instance of <code>RequestExecutor</code>, typically provided as a lambda.</li>
</ol>
<p>Because of the large number HTTP clients in use within Netflix, the GraphQLClient is decoupled from any particular HTTP client implementation.
Any HTTP client (RestTemplate, RestClient, OkHTTP, ....) can be used.
The developer is responsible for making the actual HTTP call by implementing a <code>RequestExecutor</code>.
<code>RequestExecutor</code> receives the <code>url</code>, a map of <code>headers</code> and the request <code>body</code> as parameters, and should return an instance of <code>HttpResponse</code>.
Based on the HTTP response the GraphQLClient parses the response and provides easy access to data and errors.
The example below uses <code>RestTemplate</code>.</p>
<div class="highlight"><pre><span></span><code>private RestTemplate dgsRestTemplate;

private static final String URL = &quot;http://someserver/graphql&quot;;

private static final String QUERY = &quot;{\n&quot; +
            &quot;  ticks(first: %d, after:%d){\n&quot; +
            &quot;    edges {\n&quot; +
            &quot;      node {\n&quot; +
            &quot;        route {\n&quot; +
            &quot;          name\n&quot; +
            &quot;          grade\n&quot; +
            &quot;          pitches\n&quot; +
            &quot;          location\n&quot; +
            &quot;        }\n&quot; +
            &quot;        \n&quot; +
            &quot;        userStars\n&quot; +
            &quot;      }\n&quot; +
            &quot;    }\n&quot; +
            &quot;  }\n&quot; +
            &quot;}&quot;;

public List&lt;TicksConnection&gt; getData() {
    DefaultGraphQLClient graphQLClient = new DefaultGraphQLClient(URL);
    GraphQLResponse response = graphQLClient.executeQuery(query, new HashMap&lt;&gt;(), (url, headers, body) -&gt; {
        /**
         * The requestHeaders providers headers typically required to call a GraphQL endpoint, including the Accept and Content-Type headers.
         * To use RestTemplate, the requestHeaders need to be transformed into Spring&#39;s HttpHeaders.
         */
        HttpHeaders requestHeaders = new HttpHeaders();
        headers.forEach(requestHeaders::put);

        /**
         * Use RestTemplate to call the GraphQL service. 
         * The response type should simply be String, because the parsing will be done by the GraphQLClient.
         */
        ResponseEntity&lt;String&gt; exchange = dgsRestTemplate.exchange(url, HttpMethod.POST, new HttpEntity(body, requestHeaders), String.class);

        /**
         * Return a HttpResponse, which contains the HTTP status code and response body (as a String).
         * The way to get these depend on the HTTP client.
         */
        return new HttpResponse(exchange.getStatusCodeValue(), exchange.getBody());
    }); 

    TicksConnection ticks = graphQLResponse.extractValueAsObject(&quot;ticks&quot;, TicksConnection.class);
    return ticks;
}
</code></pre></div>
<p>The <code>GraphQLClient</code> provides methods to parse and retrieve data and errors in a variety of ways.
Refer to the <code>GrqphQLClient</code> JavaDoc for the complete list of supported methods.</p>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>getData</td>
<td>Get the data as a Map<String, Object></td>
<td><code>Map&lt;String,Object&gt; data = response.getData()</code></td>
</tr>
<tr>
<td>dataAsObject</td>
<td>Parse data as the provided class, using the Jackson Object Mapper</td>
<td><code>TickResponse data = response.dataAsObject(TicksResponse.class)</code></td>
</tr>
<tr>
<td>extractValue</td>
<td>Extract values given a <a href="https://github.com/json-path/JsonPath">JsonPath</a>. The return type will be whatever type you expect, but depends on the JSON shape. For JSON objects, a Map is returned. Although this looks type safe, it really isn't. It's mostly useful for "simple" types like String, Int etc., and Lists of those types.</td>
<td><code>List&lt;String&gt; name = response.extractValue("movies[*].originalTitle")</code></td>
</tr>
<tr>
<td>extractValueAsObject</td>
<td>Extract values given a JsonPath and deserialize into the given class</td>
<td><code>Ticks ticks = response.extractValueAsObject("ticks", Ticks.class)</code></td>
</tr>
<tr>
<td>extractValueAsObject</td>
<td>Extract values given a JsonPath and deserialize into the given TypeRef. Useful for Maps and Lists of a certain class.</td>
<td><code>List&lt;Route&gt; routes = response.extractValueAsObject("ticks.edges[*].node.route", new TypeRef&lt;List&lt;Route&gt;&gt;(){})</code></td>
</tr>
<tr>
<td>getRequestDetails</td>
<td>Extract a <code>RequestDetails</code> object. This only works if requestDetails was requested in the query, and against the Gateway.</td>
<td>RequestDetails requestDetails = <code>response.getRequestDetails()</code></td>
</tr>
<tr>
<td>getParsed</td>
<td>Get the parsed <code>DocumentContext</code> for further JsonPath processing</td>
<td><code>response.getDocumentContext()</code></td>
</tr>
</tbody>
</table>
<h3 id="errors">Errors</h3>
<p>The GraphQLClient checks both for HTTP level errors (based on the response status code) and the <code>errors</code> block in a GraphQL response.
The GraphQLClient is compatible with the <a href="../advanced/graphql-error-spec/">Errors Spec</a> used by the Gateway and DGS, and makes it easy to extract error information such as the ErrorType.</p>
<p>For example, for following GraphQL response the GraphQLClient lets you easily get the ErrorType and ErrorDetail fields.
Note that the <code>ErrorType</code> is an enum as specified by the <a href="advanced/graphql-error-spec">Errors Spec</a>.</p>
<div class="highlight"><pre><span></span><code>{
  &quot;errors&quot;: [
    {
      &quot;message&quot;: &quot;java.lang.RuntimeException: test&quot;,
      &quot;locations&quot;: [],
      &quot;path&quot;: [
        &quot;hello&quot;
      ],
      &quot;extensions&quot;: {
        &quot;errorType&quot;: &quot;BAD_REQUEST&quot;,
        &quot;errorDetail&quot;: &quot;FIELD_NOT_FOUND&quot;
      }
    }
  ],
  &quot;data&quot;: {
    &quot;hello&quot;: null
  }
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">assertThat</span><span class="p">(</span><span class="n">graphQLResponse</span><span class="p">.</span><span class="na">errors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">extensions</span><span class="p">.</span><span class="na">errorType</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="n">assertThat</span><span class="p">(</span><span class="n">graphQLResponse</span><span class="p">.</span><span class="na">errors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">extensions</span><span class="p">.</span><span class="na">errorDetail</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;FIELD_NOT_FOUND&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="type-safe-query-api">Type safe Query API</h2>
<p>Based on a GraphQL schema a type safe query API can be generated for Java/Kotlin.
The generated API is a builder style API that lets you build a GraphQL query and it's projection (field selection).
Because the code gets re-generated when the schema changes, it helps catch errors in the query.
Because Java doesn't support multi-line strings (yet) it's also arguably a more readable way to specify a query.</p>
<p>If you own a DGS and want to generate a client for this DGS (e.g. for testing purposes) the client generation is just an extra property on the <a href="generating-code-from-schema">Codegen configuration</a>.
Specify the following in your <code>build.gradle</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">buildscript</span> <span class="o">{</span>
   <span class="n">dependencies</span><span class="o">{</span>
      <span class="n">classpath</span> <span class="s1">&#39;netflix:graphql-dgs-codegen-gradle:latest.release&#39;</span>
   <span class="o">}</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;codegen-gradle-plugin&#39;</span>

<span class="n">generateJava</span><span class="o">{</span>
   <span class="n">packageName</span> <span class="o">=</span> <span class="s1">&#39;com.example.packagename&#39;</span> <span class="c1">// The package name to use to generate sources</span>
   <span class="n">generateClient</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">}</span>
</code></pre></div>
<p>Code will be generated on build.
The generated code is in <code>build/generated</code>.</p>
<p>With codegen configured correctly, a builder style API will be generated when building the project.
Using the same query example as above, the query can be build using the generated builder API.</p>
<div class="highlight"><pre><span></span><code>GraphQLQueryRequest graphQLQueryRequest =
                new GraphQLQueryRequest(
                    new TicksGraphQLQuery.Builder()
                        .first(first)
                        .after(after)
                        .build(),
                    new TicksConnectionProjectionRoot()
                        .edges()
                            .node()
                                .date()
                                .route()
                                    .name()
                                    .votes()
                                        .starRating()
                                        .parent()
                                    .grade());

String query = graphQLQueryRequest.serialize();
</code></pre></div>
<p>The <code>GraphQLQueryRequest</code> is a class from <code>graphql-dgs-client</code>.
The <code>TicksGraphQLQuery</code> and <code>TicksConnectionProjectionRoot</code> are generated.
After building the query, it can be serialized to a String, and executed using the GraphQLClient.</p>
<p>Note that the <code>edges</code> and <code>node</code> fields are because the example schema is using Relay pagination.</p>
<h3 id="interface-projections">Interface projections</h3>
<p>When a field returns an interface, fields on the concrete types are specified using a fragment.</p>
<div class="highlight"><pre><span></span><code>type Query @extends {
    script(name: String): Script
}

interface Script {
    title: String
    director: String
    actors: [Actor]
}

type MovieScript implements Script {
    title: String
    director: String
    length: Int
}

type ShowScript implements Script {
    title: String
    director: String
    episodes: Int
}
</code></pre></div>
<div class="highlight"><pre><span></span><code>query { 
    script(name: &quot;Top Secret&quot;) { 
        title 
        ... on MovieScript {
            length
        } 
    } 
}
</code></pre></div>
<p>This syntax is supported by the Query builder as well.</p>
<div class="highlight"><pre><span></span><code> <span class="n">GraphQLQueryRequest</span> <span class="n">graphQLQueryRequest</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">GraphQLQueryRequest</span><span class="p">(</span>
        <span class="k">new</span> <span class="n">ScriptGraphQLQuery</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
            <span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;Top Secret&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="na">build</span><span class="p">(),</span>
        <span class="k">new</span> <span class="n">ScriptProjectionRoot</span><span class="p">()</span>
            <span class="p">.</span><span class="na">title</span><span class="p">()</span>
            <span class="p">.</span><span class="na">onMovieScript</span><span class="p">()</span>
                <span class="p">.</span><span class="na">length</span><span class="p">();</span>                    
    <span class="p">);</span>
</code></pre></div>
<h3 id="building-federated-queries">Building Federated Queries</h3>
<p>You can use <code>GraphQLQueryRequest</code> along with <code>EntitiesGraphQLQuery</code> to generated federated queries. 
The API provides a type-safe way to construct the <a href="https://www.apollographql.com/docs/apollo-server/federation/federation-spec/#resolve-requests-for-entities">_entities</a> query with the associated <code>representations</code> based on the input schema. 
The <code>representations</code> are passed in as a map of variables. Each representation class is generated based on the <code>key</code> fields defined  on the entity in your schema, along with the <code>__typename</code>. 
The <code>EntitiesProjectionRoot</code> is used to select query fields on the specified type.</p>
<p>For example, let us look at a schema that extends a <code>Movie</code> type:</p>
<div class="highlight"><pre><span></span><code>type Movie @key(fields: &quot;movieId&quot;) @extends {
    movieId: Int @external
    script: MovieScript
}

type MovieScript  {
    title: String
    director: String
    actors: [Actor]
}

type Actor {
    name: String
    gender: String
    age: Int
}
</code></pre></div>
<p>With client code generation, you will now have a <code>MovieRepresentation</code> containing the key field, i.e., <code>movieId</code>, and the <code>__typename</code> field already set to type <code>Movie</code>. 
Now you can add each representation to the <code>EntitiesGraphQLQuery</code> as a <code>representations</code> variable.
You will also have a <code>EntitiesProjectionRoot</code> with <code>onMovie()</code> to select fields on <code>Movie</code> from.
Finally, you put them all together as a <code>GraphQLQueryRequest</code>, which you serialize into the final query string.
The map of <code>representations</code> variables is available via <code>getVariables</code> on the <code>EntitiesGraphQLQuery</code>.</p>
<p>Here is an example for the schema shown earlier:
<div class="highlight"><pre><span></span><code>        <span class="n">EntitiesGraphQLQuery</span> <span class="n">entitiesQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EntitiesGraphQLQuery</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
                    <span class="p">.</span><span class="na">addRepresentationAsVariable</span><span class="p">(</span>
                            <span class="n">MovieRepresentation</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">movieId</span><span class="p">(</span><span class="mi">1122</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="p">.</span><span class="na">build</span><span class="p">();</span>
        <span class="n">GraphQLQueryRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GraphQLQueryRequest</span><span class="p">(</span>
                    <span class="n">entitiesQuery</span><span class="p">,</span>
                    <span class="k">new</span> <span class="n">EntitiesProjectionRoot</span><span class="p">().</span><span class="na">onMovie</span><span class="p">().</span><span class="na">movieId</span><span class="p">().</span><span class="na">script</span><span class="p">().</span><span class="na">title</span><span class="p">()</span>
                    <span class="p">);</span>

        <span class="n">String</span> <span class="n">query</span>  <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">serialize</span><span class="p">();</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">representations</span> <span class="o">=</span> <span class="n">entitiesQuery</span><span class="p">.</span><span class="na">getVariables</span><span class="p">();</span>
</code></pre></div></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../advanced/error-handling/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Error Handling
              </div>
            </div>
          </a>
        
        
          <a href="../advanced/customizing/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Custom Extensions
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/mermaid.min.js"></script>
      
    
  </body>
</html>