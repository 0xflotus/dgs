
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Testing - The DGS Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="The DGS Framework" class="md-header-nav__button md-logo" aria-label="The DGS Framework">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            The DGS Framework
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Testing
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The DGS Framework" class="md-nav__button md-logo" aria-label="The DGS Framework">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    The DGS Framework
  </label>
  
    <div class="md-nav__source">
      
<a href="/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Testing
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Testing
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-graphql-queries-for-tests" class="md-nav__link">
    Building GraphQL Queries for Tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-external-service-calls-in-tests" class="md-nav__link">
    Mocking External Service Calls in Tests
  </a>
  
    <nav class="md-nav" aria-label="Mocking External Service Calls in Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-exceptions" class="md-nav__link">
    Testing Exceptions
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mutations/" class="md-nav__link">
      Mutations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../generating-code-from-schema/" class="md-nav__link">
      Code Generation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-loaders/" class="md-nav__link">
      Async Data Fetching
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced/error-handling/" class="md-nav__link">
      Error Handling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      Advanced
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Advanced" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../java-client/" class="md-nav__link">
      Java GraphQL Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/customizing/" class="md-nav__link">
      Custom Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/security/" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/file-uploads/" class="md-nav__link">
      File Uploads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/subscriptions/" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/type-resolvers-for-abstract-types/" class="md-nav__link">
      Type Resolvers for Abstract Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/custom-datafetcher-context/" class="md-nav__link">
      Data Fetching Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/federated-testing/" class="md-nav__link">
      Federated Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/schema-from-code/" class="md-nav__link">
      Generating Schema from Code
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-graphql-queries-for-tests" class="md-nav__link">
    Building GraphQL Queries for Tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-external-service-calls-in-tests" class="md-nav__link">
    Mocking External Service Calls in Tests
  </a>
  
    <nav class="md-nav" aria-label="Mocking External Service Calls in Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-exceptions" class="md-nav__link">
    Testing Exceptions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="/edit/query-execution-testing.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Testing</h1>
                
                <p>The DGS framework allows you to write lightweight tests that partially bootstrap the framework, just enough to run queries.</p>
<h3 id="example">Example</h3>
<p>Create some tests for the <code>hello</code> query that you created in the <a href="tutorial.md">Tutorial</a>.</p>
<p>Before writing tests, you need to add JUnit to the [Gradle] configuration.
This example uses JUnit 5:</p>
<div class="highlight"><pre><span></span><code><span class="n">testImplementation</span><span class="o">(</span><span class="s2">&quot;org.junit.jupiter:junit-jupiter-api:5.5.1&quot;</span><span class="o">)</span>
<span class="n">testRuntimeOnly</span><span class="o">(</span><span class="s2">&quot;org.junit.jupiter:junit-jupiter-engine:5.5.1&quot;</span><span class="o">)</span>
<span class="n">testCompile</span> <span class="s1">&#39;com.netflix.spring:spring-boot-netflix-starter-test&#39;</span>
</code></pre></div>
<p>Create a test class with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.netflix.graphql.dgs.DgsQueryExecutor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.netflix.graphql.dgs.autoconfig.DgsAutoConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.assertj.core.api.Assertions.assertThat</span><span class="p">;</span>

<span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">classes</span> <span class="o">=</span> <span class="p">{</span><span class="n">HelloDataFetcher</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">DgsAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">},</span>
                <span class="c1">// The following line disables DGS reload behavior in tests</span>
                <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dgs.reload=false&quot;</span><span class="p">})</span>
<span class="kd">class</span> <span class="nc">HelloDataFetcherTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">DgsQueryExecutor</span> <span class="n">queryExecutor</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">helloShouldIncludeName</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">queryExecutor</span><span class="p">.</span><span class="na">executeAndExtractJsonPath</span><span class="p">(</span><span class="s">&quot;{hello(name: \&quot;DGS\&quot;)}&quot;</span><span class="p">,</span> <span class="s">&quot;data.hello&quot;</span><span class="p">);</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">message</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;hello, DGS!&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">helloShouldWorkWithoutName</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">queryExecutor</span><span class="p">.</span><span class="na">executeAndExtractJsonPath</span><span class="p">(</span><span class="s">&quot;{hello}&quot;</span><span class="p">,</span> <span class="s">&quot;data.hello&quot;</span><span class="p">);</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">message</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;hello, stranger!&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">helloShouldIncludeNameWithVariables</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">queryExecutor</span><span class="p">.</span><span class="na">executeAndExtractJsonPath</span><span class="p">(</span><span class="s">&quot;query Hello($name: String) { hello(name: $name)}&quot;</span><span class="p">,</span> <span class="s">&quot;data.hello&quot;</span><span class="p">,</span> <span class="n">Maps</span><span class="p">.</span><span class="na">newHashMap</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;DGS&quot;</span><span class="p">));</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">message</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;hello, DGS!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>@SpringBootTest</code> annotation makes this a Spring test.
If you do not specify <code>classes</code> explicitly, Spring will start all components on the classpath.
This includes not only your code, but also the full Netflix ecosystem.
That really slows down tests, and most components aren’t necessary for testing!
It’s much better to explicitly list the classes that you need for this test.
In this case that’s just <code>HelloDataFetcher.class</code> and <code>DgsAutoConfiguration.class</code>.
<code>HelloDataFetcher</code> is obviously your code, and <code>DgsAutoConfiguration</code> starts the DGS-related components.</p>
<p>To run queries, inject <code>DgsQueryExecutor</code> in the test.
This interface has several methods to execute a query and get back the result.
It executes the exact same code as a query on the <code>/graphql</code> endpoint would, but you won’t have to deal with HTTP in your tests.
The <code>DgsQueryExecutor</code> methods accept JSON paths, so that the methods can easily extract just the data from the response that you’re interested in.
The JSON paths are supported by the open source <a href="https://github.com/json-path/JsonPath">JsonPath library</a>.</p>
<p>Run the tests from your IDE, and you’ll find that one of them is failing, because an empty name is not handled very nicely.
That should be an easy fix, and demonstrates how easy it is to write useful tests.</p>
<h2 id="building-graphql-queries-for-tests">Building GraphQL Queries for Tests</h2>
<p>In the examples shown previously, we handcrafted the query string. 
This is simple enough for queries that are straightforward. 
However, constructing longer query strings can be tedious. 
For this, we can use the <a href="../java-client/">GraphQLQueryRequest</a> to build the graphql request in combination with the <a href="../generating-code-from-schema/">code generation</a> plugin to generate the classes needed to use the request builder. 
This provides a convenient type-safe way to build your queries.</p>
<p>To set up code generation to generate the required classes to use for building your queries, follow the instructions <a href="../java-client/#type-safe-query-api">here</a>.</p>
<p>You will also need to add <code>com.netflix.graphql.dgs:graphql-dgs-client:latest.release</code> dependency to build.gradle.  </p>
<p>Now we can write a test that uses <code>GraphQLQueryRequest</code> to build the query and extract the response using <code>GraphQLResponse</code> for data fetchers for the following schema:
<div class="highlight"><pre><span></span><code>type Query @extends {
    movieScript(movieId: ID): Movie
}

type Movie @key(fields: &quot;movieId&quot;) @extends {
    movieId: ID!
    script: MovieScript
}

type MovieScript  {
    title: String
    director: String
    actors: [Actor]
}

type Actor {
    name: String
    gender: String
    age: Int
}
</code></pre></div>
The code generation plugin will generate the required POJOs, in addition to <code>MovieScriptGraphQLQuery</code> and a <code>MovieScriptProjection</code>.
The <code>MovieScriptGraphQLQuery</code> has a builder to represent the query with input types. The <code>MovieScriptProjection</code> lets you specify the fields you want in the response.</p>
<p>You can now set up your test like this:
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">scriptShouldIncludeTitle</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
    <span class="n">GraphQLQueryRequest</span> <span class="n">graphQLQueryRequest</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">GraphQLQueryRequest</span><span class="p">(</span>
                    <span class="k">new</span> <span class="n">MovieScriptGraphQLQuery</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
                            <span class="p">.</span><span class="na">movieId</span><span class="p">(</span><span class="s">&quot;111888999&quot;</span><span class="p">)</span>
                            <span class="p">.</span><span class="na">build</span><span class="p">(),</span>
                    <span class="k">new</span> <span class="n">MovieScriptProjectionRoot</span><span class="p">().</span><span class="na">script</span><span class="p">().</span><span class="na">title</span><span class="p">().</span><span class="na">actors</span><span class="p">().</span><span class="na">name</span><span class="p">().</span><span class="na">age</span><span class="p">().</span><span class="na">parent</span><span class="p">().</span><span class="na">director</span><span class="p">()</span>
            <span class="p">);</span>
    <span class="c1">// This generates &quot;query {movieScript(movieId: &quot;111888999&quot;){ script { title actors { name age } director } } }&quot;</span>
    <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">graphQLQueryRequest</span><span class="p">.</span><span class="na">serialize</span><span class="p">();</span>

    <span class="n">DocumentContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">queryExecutor</span><span class="p">.</span><span class="na">executeAndGetDocumentContext</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
    <span class="n">GraphQLResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GraphQLResponse</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">jsonString</span><span class="p">());</span>
    <span class="n">Movie</span> <span class="n">movie</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="na">extractValueAsObject</span><span class="p">(</span><span class="s">&quot;data.movieScript&quot;</span><span class="p">,</span> <span class="n">Movie</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
    <span class="n">assertThat</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">getScript</span><span class="p">().</span><span class="na">getTitle</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Top Secret&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The <code>GraphQLQueryRequest</code> is available as part of the <a href="../java-client/">graphql-client module</a> and is used to build the query string, and wrap the response respectively. You can also refer to the GraphQLClient JavaDoc for more details on the list of supported methods.</p>
<h2 id="mocking-external-service-calls-in-tests">Mocking External Service Calls in Tests</h2>
<p>It’s not uncommon for a data fetcher to talk to external systems: either a database or a remote service.
If it does so within a test, this adds two problems:</p>
<ol>
<li>It adds latency; your tests are going to run slower when they make a lot of external calls.</li>
<li>It adds flakiness: Did your code introduce a bug, or did something go wrong in the external system?</li>
</ol>
<p>In many cases it’s better to mock these external services.
Spring already has good support for doing so with the <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/mock/mockito/MockBean.html">@Mockbean</a> annotation, which you can leverage in your [DGS] tests.</p>
<h3 id="example_1">Example</h3>
<p>Introduce a fictional service client <code>GreeterService</code> to the project (in the real world this could be a [gRPC] client):</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GreeterService</span> <span class="p">{</span>
    <span class="n">String</span> <span class="nf">randomGreeting</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FakeGreeterServiceImpl</span> <span class="kd">implements</span> <span class="n">GreeterService</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">randomGreeting</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;This is not a real client!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The hello data fetcher should use this new <code>GreeterService</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DgsComponent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloDataFetcher</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">GreeterService</span> <span class="n">greeterService</span><span class="p">;</span>

    <span class="nd">@DgsData</span><span class="p">(</span><span class="n">parentType</span> <span class="o">=</span> <span class="s">&quot;Query&quot;</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">DataFetchingEnvironment</span> <span class="n">dfe</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">dfe</span><span class="p">.</span><span class="na">getArgument</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">greeterService</span><span class="p">.</span><span class="na">randomGreeting</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>All tests now fail, since the <code>FakeGreeterServiceImpl</code> isn’t included in the <code>classes</code> definition of <code>@SpringBootTest</code>. 
If you include it, the tests fail with the <code>RuntimeException</code> that’s thrown from the <code>randomGreeting()</code> method.
To add a mock to make the tests work again, add the following code to the test:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@MockBean</span>
<span class="n">GreeterService</span> <span class="n">greeterService</span><span class="p">;</span>

<span class="nd">@Before</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">when</span><span class="p">(</span><span class="n">greeterService</span><span class="p">.</span><span class="na">randomGreeting</span><span class="p">(</span><span class="n">anyString</span><span class="p">())).</span><span class="na">thenAnswer</span><span class="p">(</span><span class="n">invocation</span> <span class="o">-&gt;</span> <span class="s">&quot;Mocked greeting, &quot;</span> <span class="o">+</span> <span class="n">invocation</span><span class="p">.</span><span class="na">getArgument</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="testing-exceptions">Testing Exceptions</h2>
<p>The tests you wrote so far are mostly happy paths.
Failure scenarios are also easy to test.
Try a query with two fields that both return an error:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">getQueryWithMultipleExceptions</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">queryExecutor</span><span class="p">.</span><span class="na">executeAndExtractJsonPath</span><span class="p">(</span><span class="s">&quot;{withRuntimeException, withGraphqlException}&quot;</span><span class="p">,</span> <span class="s">&quot;data.greeting&quot;</span><span class="p">);</span>
        <span class="n">fail</span><span class="p">(</span><span class="s">&quot;Exception should have been thrown&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">QueryException</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getErrors</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getMessage</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;java.lang.RuntimeException: That&#39;s broken!&quot;</span><span class="p">);</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getErrors</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">getMessage</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;graphql.GraphQLException: that&#39;s not going to work!&quot;</span><span class="p">);</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;java.lang.RuntimeException: That&#39;s broken!, graphql.GraphQLException: that&#39;s not going to work!&quot;</span><span class="p">);</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getErrors</span><span class="p">().</span><span class="na">size</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>When an error happens while executing<!-- http://go/pv --> the query, the errors are wrapped<!-- http://go/pv --> and thrown<!-- http://go/pv --> in a <code>QueryException</code>.
This allows you to easily inspect the error.
The <code>message</code> of the <code>QueryException</code> is the concatenation of all the errors.
The <code>getErrors()</code> method gives access to the individual errors for further inspection. </p>
<p>--8&lt;-- "docs/reference_links"</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../getting-started/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </div>
            </div>
          </a>
        
        
          <a href="../mutations/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Mutations
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/mermaid.min.js"></script>
      
    
  </body>
</html>